---
title: "Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide

---
```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(modelr)
library(haven)
library(plotly)
library(factoextra)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%",
  warning = FALSE,
  message = FALSE
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```



```{r}
ratings_df = read_csv("data/coffee_ratings.csv") %>%
  janitor::clean_names() %>%
  select(total_cup_points, species, country_of_origin, 
         region, grading_date, variety,processing_method, 
         aroma, flavor, aftertaste, acidity, body, balance,
         sweetness, moisture, color, altitude_low_meters, 
         altitude_high_meters, altitude_mean_meters,) %>%
  mutate(grading_year = str_extract(grading_date, "\\d{4}"),
         species = as.factor(species),
         variety = as.factor(variety),
         processing_method = as.factor(processing_method),
         moisture = as.factor(moisture),
         color = as.factor(color))
  
```



## Correlation Test

```{r}
features <- c("aroma", "flavor", "aftertaste", "acidity", "body", "balance", "sweetness")
target <- "total_cup_points"
```

We chose the variables associated with sensory scores, which are aroma, flavor, aftertaste, acidity, body, balance, and sweetness, as the predictor variables of the model, and the total cup points as the response variable.



```{r}
corr_matrix = cor(ratings_df[, c(features, target)], use = "complete.obs")
corrplot(corr_matrix, method = "number", type = "upper", tl.cex = 0.8)
```


Before building the model, we performed the correlation test between these variables. We found a high correlation between almost all independent variables and the dependent variable, and although the correlation between sweetness and total cup points was the lowest, there was still some correlation. Since there were so many predictors, we would choose to build a lasso model.






